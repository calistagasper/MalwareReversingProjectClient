//
// Created by cgkik on 4/13/2021.
//

// client.c
// Liam Barry, Carly Etlinger, Calista Gasper
// This is the client program.

#include <unistd.h>
#include <stdio.h>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <string.h>
#define PORT 8888

int main(){
    int sock;
    struct sockaddr_in server;
    // char *hello = "Hello from client";
    char buffer[1024];
    char serverResponse[2000];
    int readSize;

    // create the socket
    sock = socket(AF_INET, SOCK_STREAM, 0);
    if (sock == -1)
    {
        printf("Failed to create socket");
    }
    puts("Socket created successfully");

    // Creating the sockaddr_in structure with values
    server.sin_addr.s_addr = inet_addr("127.0.0.1");
    server.sin_family = AF_INET;
    server.sin_port = htons(PORT);

    // connect to remote server
    if (connect(sock, (struct sockaddr *)&server, sizeof(server)) < 0)
    {
        // output error in connecting to remote server
        perror("Connection to server failed");
        return 1;
    }
    puts("Connected to server successfully\n");

    // now wait for command from server
    while((readSize = recv(sock, buffer, 1024, 0)) > 0){
        // take the contents of the buffer and determine what command is trying to run -- run appropriate command

        // testing purposes: output command from server
        printf("%s\n", buffer);

        if(readSize == 0)
        {
            puts("Client disconnected");
            fflush(stdout);
        }
        else if (readSize == -1)
        {
            perror("Receiving content from client failed");
        }
    }


// this code is to get the CLIENT to send things to the SERVER. We want the other direction.
/*
    // maintain connection with server
    while(1)
    {
        printf("Enter your message to the server: ");
        scanf("%s", buffer);

        // send the server the message from client
        if (send(sock, buffer, strlen(buffer), 0) < 0)
        {
            // output error in sending data to server
            puts("Sending data to server failed");
            return 1;
        }

        // receive response from the server
        if (recv(sock, serverResponse, 2000, 0) < 0)
        {
            puts("Receiving data from server failed");
            return 1;
        }

        // otherwise, if all is hunky-dory, output the response from the server
        puts("Server response: ");
        puts(serverResponse);
        //break;
    }
*/
    close(sock);
    return 0;
}


